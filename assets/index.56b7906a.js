var et=Object.defineProperty,tt=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var Ae=(e,n,s)=>n in e?et(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,b=(e,n)=>{for(var s in n||(n={}))st.call(n,s)&&Ae(e,s,n[s]);if(Fe)for(var s of Fe(n))ot.call(n,s)&&Ae(e,s,n[s]);return e},D=(e,n)=>tt(e,nt(n));import{R as t,c as g,r as d,f as fe,E as $e,a as re,b as at,d as _,e as he,u as Le,g as rt,h as T,i as Ie,j as Ee,Z as G,k as lt,l as ye,m as ct,n as xe,o as it,p as ut,q as mt,s as Q,t as dt,A as pt,F as ft,v as ht,N as Et,S as yt,w as Be,x as xt,H as gt}from"./vendor.ca041cc5.js";const vt=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}};vt();function X(){return navigator.userAgent==="ClashX Runtime"}let N=null;class wt{constructor(n){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(s=>{this.instance=s,n()})}initBridge(n){if(!X())return n==null?void 0:n(null);if(window.WebViewJavascriptBridge!=null)return n(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(n);window.WVJBCallbacks=[n];const s=document.createElement("iframe");s.style.display="none",s.src="https://__bridge_loaded__",document.documentElement.appendChild(s),setTimeout(()=>document.documentElement.removeChild(s),0)}async callHandler(n,s){return await new Promise(a=>{var o;(o=this.instance)==null||o.callHandler(n,s,a)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(n){return await this.callHandler("setPasteboard",n)}async writeConfigWithString(n){return await this.callHandler("writeConfigWithString",n)}async setSystemProxy(n){return await this.callHandler("setSystemProxy",n)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(n){return await this.callHandler("speedTest",n)}async setStartAtLogin(n){return await this.callHandler("setStartAtLogin",n)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function Ct(e){if(N!=null){e();return}N=new wt(e)}function z(e){const{title:n,children:s,className:a,style:o}=e;return t.createElement("header",{className:g("header",a),style:o},t.createElement("h1",{className:"md:text-xl"},n),t.createElement("div",{className:"flex flex-auto items-center justify-end"},s))}function R(e){const{type:n,size:s=14,className:a,style:o}=e,r=g("clash-iconfont",`icon-${n}`,a),l=b({fontSize:s},o),c=D(b({},e),{className:r,style:l});return t.createElement("i",b({},c))}function H(){}function bt(e,n){const s=[],a=[];for(const o of e)n(o)?s.push(o):a.push(o);return[s,a]}function M(e){const n=["B","KB","MB","GB","TB"];let s=0;for(;~~(e/1024)&&s<n.length;)e/=1024,s++;return`${s===0?e:e.toFixed(2)} ${n[s]}`}function ge(e){const{className:n,checked:s=!1,disabled:a=!1,onChange:o=H}=e,r=g("switch",{checked:s,disabled:a},n);function l(){a||o(!s)}return t.createElement("div",{className:r,onClick:l},t.createElement(R,{className:"switch-icon font-bold",type:"check",size:20}))}const U=d.exports.forwardRef((e,n)=>{const{className:s,style:a,children:o}=e;return t.createElement("div",{className:g("card",s),style:a,ref:n},o)});function Te(e){const{options:n,value:s,onSelect:a}=e;return t.createElement("div",{className:"button-select"},n.map(o=>t.createElement("button",{value:o.value,key:o.value,className:g("button-select-options",{actived:s===o.value}),onClick:()=>a==null?void 0:a(o.value)},o.label)))}const Nt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",type:"Type",chains:"Chains",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Upload",download:"Download",network:"Network",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},Pt={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",socks5ProxyPort:"Socks5 \u4EE3\u7406\u7AEF\u53E3",httpProxyPort:"HTTP \u4EE3\u7406\u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u4EE3\u7406\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},columns:{host:"\u57DF\u540D",network:"\u7F51\u7EDC",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",sourceIP:"\u6765\u6E90 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5305\u542B\u7B56\u7565\u7EC4\u7684\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},Re={en_US:Nt,zh_CN:Pt},St=Object.keys(Re);function kt(){for(const e of window.navigator.languages){if(e.includes("zh"))return"zh_CN";if(e.includes("us"))return"en_US"}return"en_US"}function ve(e){return d.exports.useMemo(()=>{function s(a,o){if(typeof a=="string")e(r=>{const l=a,c=o;r[l]=c});else if(typeof a=="function"){const r=a;e(l=>r(l))}else typeof a=="object"&&e(r=>fe(r,l=>{const c=a;for(const u of Object.keys(c)){const f=u;l[f]=c[f]}}))}return s},[e])}class He{constructor(n){this.EE=new $e,this.innerBuffer=[],this.isClose=!1,this.config=Object.assign({bufferLength:0,retryInterval:5e3,headers:{}},n),this.config.useWebsocket?this.websocketLoop():this.loop()}websocketLoop(){var a;const n=new URL(this.config.url);n.protocol=n.protocol==="http:"?"ws:":"wss:",n.searchParams.set("token",(a=this.config.token)!=null?a:"");const s=new WebSocket(n.toString());s.addEventListener("message",o=>{const r=JSON.parse(o.data);this.EE.emit("data",[r]),this.config.bufferLength>0&&(this.innerBuffer.push(r),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),s.addEventListener("close",()=>setTimeout(this.websocketLoop,this.config.retryInterval)),s.addEventListener("error",o=>{this.EE.emit("error",o),setTimeout(this.websocketLoop,this.config.retryInterval)})}async loop(){const n=await re.fromPromise(fetch(this.config.url,{mode:"cors",headers:this.config.token?{Authorization:`Bearer ${this.config.token}`}:{}}),o=>o);if(n.isErr()){this.retry(n.error);return}else if(n.value.body==null){this.retry(new Error("fetch body error"));return}const s=n.value.body.getReader(),a=new TextDecoder;for(;!this.isClose;){const o=await re.fromPromise(s==null?void 0:s.read(),c=>c);if(o.isErr()){this.retry(o.error);break}const l=a.decode(o.value.value).trim().split(`
`).map(c=>JSON.parse(c));this.EE.emit("data",l),this.config.bufferLength>0&&(this.innerBuffer.push(...l),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}}retry(n){this.isClose||(this.EE.emit("error",n),window.setTimeout(()=>{this.loop()},this.config.retryInterval))}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}buffer(){return this.innerBuffer.slice()}destory(){this.EE.removeAllListeners(),this.isClose=!0}}class Dt{constructor(n,s){this.axiosClient=at.create({baseURL:n,headers:s?{Authorization:`Bearer ${s}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(n){return await this.axiosClient.patch("configs",n)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const n=await this.axiosClient.get("providers/proxies",{validateStatus(s){return s>=200&&s<300||s===404}});return n.status===404&&(n.data={providers:{}}),n}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(n){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(n)}`)}async updateRuleProvider(n){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(n)}`)}async healthCheckProvider(n){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(n)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(n){return await this.axiosClient.delete(`connections/${n}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(n,s){return await this.axiosClient.put(`proxies/${encodeURIComponent(n)}`,{name:s})}}const Ft=_(async()=>{if(!X())return null;const e=await N.getAPIInfo();return{hostname:e.host,port:e.port,secret:e.secret,protocol:"http:"}}),Me=he("externalControllers",[]);function ee(){var f,i,m,h,E,w,F,A,L,k,P,I,V,J,j;const e=Le(Ft),n=rt(),s=Le(Me);if(e!=null)return e;let a;{const O=document.querySelector('meta[name="external-controller"]');((f=O==null?void 0:O.content)==null?void 0:f.match(/^https?:/))!=null&&(a=new URL(O.content))}const o=new URLSearchParams(n.search),r=(E=(h=(m=o.get("host"))!=null?m:(i=s==null?void 0:s[0])==null?void 0:i.hostname)!=null?h:a==null?void 0:a.hostname)!=null?E:window.location.hostname,l=(L=(A=(F=o.get("port"))!=null?F:(w=s==null?void 0:s[0])==null?void 0:w.port)!=null?A:a==null?void 0:a.port)!=null?L:window.location.port,c=(V=(I=(P=o.get("secret"))!=null?P:(k=s==null?void 0:s[0])==null?void 0:k.secret)!=null?I:a==null?void 0:a.username)!=null?V:"",u=((J=o.get("protocol"))!=null?J:r==="127.0.0.1")?"http:":(j=a==null?void 0:a.protocol)!=null?j:window.location.protocol;return{hostname:r,port:l,secret:c,protocol:u}}const At=_({key:"",instance:null});function $(){const{hostname:e,port:n,secret:s,protocol:a}=ee(),[o,r]=T(At),l=`${a}//${e}:${n}?secret=${s}`;if(o.key===l)return o.instance;const c=new Dt(`${a}//${e}:${n}`,s);return r({key:l,instance:c}),c}const we=_(!0),$t=he("language",void 0);function S(){const[e,n]=T($t),s=d.exports.useMemo(()=>e!=null?e:kt(),[e]),a=d.exports.useCallback(function(o){function r(l){return lt(Re[s][o],l)}return{t:r}},[s]);return{lang:s,locales:St,setLang:n,translation:a}}const Ue=_({version:"",premium:!1});function le(){const[e,n]=T(Ue),s=$(),a=Ee(we);return G([s],async function(){const o=await re.fromPromise(s.getVersion(),r=>r);a(o.isOk()),n(o.isErr()?{version:"",premium:!1}:{version:o.value.data.version,premium:!!o.value.data.premium})}),e}function Oe(){const[{premium:e}]=T(Ue),n=$(),{data:s,mutate:a}=G(["/providers/rule",n,e],async()=>{if(!e)return[];const o=await n.getRuleProviders();return Object.keys(o.data.providers).map(r=>o.data.providers[r])});return{providers:s!=null?s:[],update:a}}const Lt=he("profile",{breakConnections:!1});function We(){const[e,n]=T(Lt),s=d.exports.useCallback(a=>{n(fe(e,a))},[e,n]);return{data:e,set:ve(s)}}const ze=_([]);function je(){const[e,n]=T(ze),s=$(),{data:a,mutate:o}=G(["/providers/proxy",s],async()=>{const r=await s.getProxyProviders();return Object.keys(r.data.providers).map(l=>r.data.providers[l]).filter(l=>l.name!=="default").filter(l=>l.vehicleType!=="Compatible")});return d.exports.useEffect(()=>{n(a!=null?a:[])},[a,n]),{providers:e,update:o}}function Ce(){const e=$(),{data:n,mutate:s}=G(["/config",e],async()=>{var r;const o=(await e.getConfig()).data;return{port:o.port,socksPort:o["socks-port"],mixedPort:(r=o["mixed-port"])!=null?r:0,redirPort:o["redir-port"],mode:o.mode.toLowerCase(),logLevel:o["log-level"],allowLan:o["allow-lan"]}});return{general:n!=null?n:{},update:s}}const _e=Ie({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function ce(){const[e,n]=T(_e),s=ve(n),a=$(),{mutate:o}=G(["/proxies",a],async()=>{const l=await a.getProxies(),c=l.data.proxies.GLOBAL;c.name="GLOBAL";const u=new Set(["Selector","URLTest","Fallback","LoadBalance"]),f=new Set(["DIRECT","REJECT","GLOBAL"]),i=c.all.filter(E=>!f.has(E)).map(E=>D(b({},l.data.proxies[E]),{name:E})),[m,h]=bt(i,E=>!u.has(E.type));s({proxies:m,groups:h,global:c})}),r=d.exports.useCallback((l,c)=>{s(u=>{l==="GLOBAL"&&(u.global.now=c);for(const f of u.groups)f.name===l&&(f.now=c)})},[s]);return{proxies:e.proxies,groups:e.groups,global:e.global,update:o,markProxySelected:r,set:s}}const It=_(e=>{const n=e(_e),s=e(ze),a=new Map;for(const o of n.proxies)a.set(o.name,o);for(const o of s)for(const r of o.proxies)a.set(r.name,r);return a});function Ge(){const{data:e,mutate:n}=G("/clashx",async()=>{var o,r;if(!X())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const s=(o=await(N==null?void 0:N.getStartAtLogin()))!=null?o:!1,a=(r=await(N==null?void 0:N.isSystemProxySet()))!=null?r:!1;return{startAtLogin:s,systemProxy:a,isClashX:!0}});return{data:e,update:n}}const Bt=Ie([]);function Tt(){const[e,n]=T(Bt),s=ve(n),a=$();async function o(){const r=await a.getRules();s(r.data.rules)}return{rules:e,update:o}}const Rt=_({key:"",instance:null});function Ve(){var i,m;const e=ee(),{general:n}=Ce(),s=le(),[a,o]=T(Rt);if(!s.version||!n.logLevel)return null;const r=!!s.version||!0,l=`${e.protocol}//${e.hostname}:${e.port}/logs?level=${(i=n.logLevel)!=null?i:""}&useWebsocket=${r}&secret=${e.secret}`;if(a.key===l)return a.instance;const c=a.instance,u=`${e.protocol}//${e.hostname}:${e.port}/logs?level=${(m=n.logLevel)!=null?m:""}`,f=new He({url:u,bufferLength:200,token:e.secret,useWebsocket:r});return o({key:l,instance:f}),c!=null&&c.destory(),f}function Ht(){const e=ee(),n=le(),s=!!n.version||!0,a=`${e.protocol}//${e.hostname}:${e.port}/connections`;return d.exports.useMemo(()=>n.version?new He({url:a,bufferLength:200,token:e.secret,useWebsocket:s}):null,[e.secret,a,s,n.version])}function Mt(e){const{className:n,data:s,onClick:a,select:o,canClick:r,errSet:l,rowHeight:c}=e,{translation:u}=S(),{t:f}=u("Proxies"),[i,m]=d.exports.useState(!1),[h,E]=d.exports.useState(!1),w=d.exports.useRef(null);d.exports.useLayoutEffect(()=>{var P,I;E(((I=(P=w==null?void 0:w.current)==null?void 0:P.offsetHeight)!=null?I:0)>30)},[]);const F=i?"auto":c,A=r?a:H;function L(){m(!i)}const k=s.map(P=>{const I=g({"tags-selected":o===P,"cursor-pointer":r,error:l==null?void 0:l.has(P)});return t.createElement("li",{className:I,key:P,onClick:()=>A(P)},P)});return t.createElement("div",{className:g("flex items-start overflow-y-hidden",n),style:{height:F}},t.createElement("ul",{ref:w,className:g("tags",{expand:i})},k),h&&t.createElement("span",{className:"h-7 px-5 select-none cursor-pointer leading-7",onClick:L},f(i?"collapseText":"expandText")))}function ie(e){const{className:n,style:s,value:a="",align:o="center",inside:r=!1,autoFocus:l=!1,type:c="text",disabled:u=!1,onChange:f=H,onBlur:i=H,onEnter:m=H}=e,h=g("input",`text-${o}`,{"focus:shadow-none":r},n);function E(w){w.code==="Enter"&&m(w)}return t.createElement("input",{disabled:u,className:h,style:s,value:a,autoFocus:l,type:c,onChange:w=>f(w.target.value,w),onBlur:i,onKeyDown:E})}function Je(e){const{show:n=!0,title:s="Modal",size:a="small",footer:o=!0,onOk:r=H,onClose:l=H,bodyClassName:c,bodyStyle:u,className:f,style:i,children:m}=e,{translation:h}=S(),{t:E}=h("Modal"),w=d.exports.useRef(document.createElement("div")),F=d.exports.useRef(null);d.exports.useLayoutEffect(()=>{const k=w.current;return document.body.appendChild(k),()=>{document.body.removeChild(k)}},[]);function A(k){k.target===F.current&&l()}const L=t.createElement("div",{className:g("modal-mask",{"modal-show":n}),ref:F,onMouseDown:A},t.createElement("div",{className:g("modal",`modal-${a}`,f),style:i},t.createElement("div",{className:"modal-title"},s),t.createElement("div",{className:g("modal-body",c),style:u},m),o&&t.createElement("div",{className:"footer"},t.createElement(be,{onClick:()=>l()},E("cancel")),t.createElement(be,{type:"primary",onClick:()=>r()},E("ok")))));return ye.exports.createPortal(L,w.current)}function be(e){const{type:n="normal",onClick:s=H,children:a,className:o,style:r,disiabled:l}=e,c=g("button",`button-${n}`,o,{"button-disabled":l});return t.createElement("button",{className:c,style:r,onClick:s,disabled:l},a)}function ue(e){const[n,s]=ct(e),a=d.exports.useMemo(()=>{function o(r,l){typeof r=="string"?s(c=>{const u=r,f=l;c[u]=f}):typeof r=="function"?s(r):typeof r=="object"&&s(c=>{const u=r;for(const f of Object.keys(u)){const i=f;c[i]=u[i]}})}return o},[s]);return[n,a]}function Ut(e,n=0){if(e.length<2)throw new Error("List requires at least two elements");const[s,a]=d.exports.useState(n);function o(){a((s+1)%e.length)}return{current:d.exports.useMemo(()=>e[s],[e,s]),next:o}}function Ne(e=!1){const[n,s]=d.exports.useState(e);function a(){s(!1)}function o(){s(!0)}return{visible:n,hide:a,show:o}}function Xe(e){const{className:n,checked:s=!1,onChange:a=H}=e,o=g("checkbox",{checked:s},n);function r(){a(!s)}return t.createElement("div",{className:o,onClick:r},t.createElement(R,{className:"checkbox-icon",type:"check",size:18}),t.createElement("div",null,e.children))}function me(e){const{color:n,className:s,style:a}=e,o=g("tag",s),r=b({color:n},a),l=D(b({},e),{className:o,style:r});return t.createElement("span",b({},l),e.children)}function Ot(e){const n=g("spinner",e.className);return t.createElement("div",{className:n},t.createElement("div",{className:"spinner-circle"},t.createElement("div",{className:"spinner-inner"})),t.createElement("div",{className:"spinner-circle"},t.createElement("div",{className:"spinner-inner"})),t.createElement("div",{className:"spinner-circle"},t.createElement("div",{className:"spinner-inner"})),t.createElement("div",{className:"spinner-circle"},t.createElement("div",{className:"spinner-inner"})),t.createElement("div",{className:"spinner-circle"},t.createElement("div",{className:"spinner-inner"})))}function Ye(e){const n=g("loading","visible",e.className);return e.visible?t.createElement("div",{className:n},t.createElement(Ot,{className:e.spinnerClassName})):null}function Wt(e){var o,r,l;const n=d.exports.useRef(document.createElement("div"));d.exports.useLayoutEffect(()=>{const c=n.current;return document.body.appendChild(c),()=>{document.body.removeChild(c)}},[]);const s="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",a=t.createElement("div",{className:g(e.className,"absolute inset-0 pointer-events-none z-9999")},t.createElement(U,{className:g(s,{"translate-x-0":e.visible}),style:{width:(o=e.width)!=null?o:400}},e.children));return ye.exports.createPortal(a,(l=(r=e.containerRef)==null?void 0:r.current)!=null?l:n.current)}xe.extend(it);function Pe(e,n){const s=n==="en_US"?"en":"zh-cn";return xe().locale(s).from(e)}var Se;(function(e){e.Domain="Domain",e.DomainSuffix="DomainSuffix",e.DomainKeyword="DomainKeyword",e.GeoIP="GeoIP",e.IPCIDR="IPCIDR",e.SrcIPCIDR="SrcIPCIDR",e.SrcPort="SrcPort",e.DstPort="DstPort",e.MATCH="MATCH",e.RuleSet="RuleSet"})(Se||(Se={}));function zt(e){const{translation:n}=S(),s=d.exports.useMemo(()=>n("Connections").t,[n]),{className:a,style:o}=e,r=g("flex flex-wrap px-1",a);function l(c){var u;(u=e.onChange)==null||u.call(e,c)}return t.createElement("div",{className:r,style:o},t.createElement("div",{className:g("connections-devices-item pt-2 mb-2",{selected:e.selected===""}),onClick:()=>l("")},s("filter.all")),e.devices.map(c=>t.createElement("div",{key:c.label,className:g("connections-devices-item pt-2 mb-2",{selected:e.selected===c.label}),onClick:()=>l(c.label)},c.label," (",c.number,")")))}function jt(e){var a,o,r,l,c,u,f,i,m,h,E;const{translation:n}=S(),s=d.exports.useMemo(()=>n("Connections").t,[n]);return t.createElement("div",{className:g(e.className,"text-sm flex flex-col")},t.createElement("div",{className:"flex my-3"},t.createElement("span",{className:"w-16 font-bold"},s("info.id")),t.createElement("span",{className:"font-mono"},e.connection.id)),t.createElement("div",{className:"flex justify-between my-3"},t.createElement("div",{className:"flex flex-1"},t.createElement("span",{className:"w-16 font-bold"},s("info.network")),t.createElement("span",{className:"font-mono"},(a=e.connection.metadata)==null?void 0:a.network)),t.createElement("div",{className:"flex flex-1"},t.createElement("span",{className:"w-16 font-bold"},s("info.inbound")),t.createElement("span",{className:"font-mono"},(o=e.connection.metadata)==null?void 0:o.type))),t.createElement("div",{className:"flex my-3"},t.createElement("span",{className:"w-16 font-bold"},s("info.host")),t.createElement("span",{className:"font-mono flex-1 break-all"},((r=e.connection.metadata)==null?void 0:r.host)?`${e.connection.metadata.host}:${(l=e.connection.metadata)==null?void 0:l.destinationPort}`:s("info.hostEmpty"))),t.createElement("div",{className:"flex my-3"},t.createElement("span",{className:"w-16 font-bold"},s("info.dstIP")),t.createElement("span",{className:"font-mono"},((c=e.connection.metadata)==null?void 0:c.destinationIP)?`${e.connection.metadata.destinationIP}:${(u=e.connection.metadata)==null?void 0:u.destinationPort}`:s("info.hostEmpty"))),t.createElement("div",{className:"flex my-3"},t.createElement("span",{className:"w-16 font-bold"},s("info.srcIP")),t.createElement("span",{className:"font-mono"},`${(f=e.connection.metadata)==null?void 0:f.sourceIP}:${(i=e.connection.metadata)==null?void 0:i.sourcePort}`)),t.createElement("div",{className:"flex my-3"},t.createElement("span",{className:"w-16 font-bold"},s("info.rule")),t.createElement("span",{className:"font-mono"},e.connection.rule&&`${e.connection.rule}${e.connection.rulePayload&&`(${e.connection.rulePayload})`}`)),t.createElement("div",{className:"flex my-3"},t.createElement("span",{className:"w-16 font-bold"},s("info.chains")),t.createElement("span",{className:"font-mono flex-1 break-all"},(m=e.connection.chains)==null?void 0:m.slice().reverse().join(" / "))),t.createElement("div",{className:"flex justify-between my-3"},t.createElement("div",{className:"flex flex-1"},t.createElement("span",{className:"w-16 font-bold"},s("info.upload")),t.createElement("span",{className:"font-mono"},M((h=e.connection.upload)!=null?h:0))),t.createElement("div",{className:"flex flex-1"},t.createElement("span",{className:"w-16 font-bold"},s("info.download")),t.createElement("span",{className:"font-mono"},M((E=e.connection.download)!=null?E:0)))),t.createElement("div",{className:"flex my-3"},t.createElement("span",{className:"w-16 font-bold"},s("info.status")),t.createElement("span",{className:"font-mono"},e.connection.completed?t.createElement("span",{className:"text-red"},s("info.closed")):t.createElement("span",{className:"text-green"},s("info.opening")))))}class _t{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(n){var a;const s=n.reduce((o,r)=>o.set(r.id,r),new Map);for(const o of this.connections.keys())if(!s.has(o))if(!this.saveDisconnection)this.connections.delete(o);else{const r=this.connections.get(o);r!=null&&this.connections.set(o,fe(r,l=>{l.completed=!0,l.uploadSpeed=0,l.downloadSpeed=0}))}for(const o of s.keys()){if(!this.connections.has(o)){this.connections.set(o,D(b({},s.get(o)),{uploadSpeed:0,downloadSpeed:0}));continue}const r=this.connections.get(o),l=s.get(o);(a=this.connections)==null||a.set(o,D(b({},l),{uploadSpeed:l.upload-r.upload,downloadSpeed:l.download-r.download}))}}toggleSave(){var n,s;if(this.saveDisconnection){this.saveDisconnection=!1;for(const a of this.connections.keys())((s=(n=this.connections)==null?void 0:n.get(a))==null?void 0:s.completed)&&this.connections.delete(a)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function Gt(){const e=d.exports.useMemo(()=>new _t,[]),n=d.exports.useRef(!0),[s,a]=d.exports.useState([]),[o,r]=d.exports.useState(!1),l=d.exports.useCallback(function(u){e.appendToSet(u),n.current&&a(e.getConnections()),n.current=!n.current},[e]),c=d.exports.useCallback(function(){const u=e.toggleSave();r(u),u||a(e.getConnections()),n.current=!0},[e]);return{connections:s,feed:l,toggleSave:c,save:o}}var y;(function(e){e.Host="host",e.Network="network",e.Type="type",e.Chains="chains",e.Rule="rule",e.Speed="speed",e.Upload="upload",e.Download="download",e.SourceIP="sourceIP",e.Time="time"})(y||(y={}));const Vt=new Set([y.Network,y.Type,y.Rule,y.Speed,y.Upload,y.Download,y.SourceIP,y.Time]);function Jt(e,n){switch(!0){case(e===0&&n===0):return"-";case(e!==0&&n!==0):return`\u2191 ${M(e)}/s \u2193 ${M(n)}/s`;case e!==0:return`\u2191 ${M(e)}/s`;default:return`\u2193 ${M(n)}/s`}}function Xt(){const{translation:e,lang:n}=S(),s=d.exports.useMemo(()=>e("Connections").t,[e]),a=Ht(),o=$(),r=d.exports.useRef(null),[l,c]=ue({uploadTotal:0,downloadTotal:0}),{visible:u,show:f,hide:i}=Ne();function m(){o.closeAllConnections().finally(()=>i())}const{connections:h,feed:E,save:w,toggleSave:F}=Gt(),A=d.exports.useMemo(()=>h.map(p=>({id:p.id,host:`${p.metadata.host||p.metadata.destinationIP}:${p.metadata.destinationPort}`,chains:p.chains.slice().reverse().join(" / "),rule:p.rule===Se.RuleSet?`${p.rule}(${p.rulePayload})`:p.rule,time:new Date(p.start).getTime(),upload:p.upload,download:p.download,sourceIP:p.metadata.sourceIP,type:p.metadata.type,network:p.metadata.network.toUpperCase(),speed:{upload:p.uploadSpeed,download:p.downloadSpeed},completed:!!p.completed,original:p})),[h]),L=d.exports.useMemo(()=>{const p=ut(h,"metadata.sourceIP");return Object.keys(p).map(C=>({label:C,number:p[C].length})).sort((C,v)=>C.label.localeCompare(v.label))},[h]),k=d.exports.useRef(null),{x:P}=mt(k),I=d.exports.useMemo(()=>[{Header:s(`columns.${y.Host}`),accessor:y.Host,minWidth:260,width:260},{Header:s(`columns.${y.Network}`),accessor:y.Network,minWidth:80,width:80},{Header:s(`columns.${y.Type}`),accessor:y.Type,minWidth:120,width:120},{Header:s(`columns.${y.Chains}`),accessor:y.Chains,minWidth:200,width:200},{Header:s(`columns.${y.Rule}`),accessor:y.Rule,minWidth:140,width:140},{id:y.Speed,Header:s(`columns.${y.Speed}`),accessor(p){return[p.speed.upload,p.speed.download]},sortType(p,C){const v=p.original.speed,Z=C.original.speed;return v.download===Z.download?v.upload-Z.upload:v.download-Z.download},minWidth:200,width:200,sortDescFirst:!0},{Header:s(`columns.${y.Upload}`),accessor:y.Upload,minWidth:100,width:100,sortDescFirst:!0},{Header:s(`columns.${y.Download}`),accessor:y.Download,minWidth:100,width:100,sortDescFirst:!0},{Header:s(`columns.${y.SourceIP}`),accessor:y.SourceIP,minWidth:140,width:140,filter:"equals"},{Header:s(`columns.${y.Time}`),accessor:y.Time,minWidth:120,width:120,sortType(p,C){return C.original.time-p.original.time}}],[s]);d.exports.useLayoutEffect(()=>{function p(C){for(const v of C)c({uploadTotal:v.uploadTotal,downloadTotal:v.downloadTotal}),E(v.connections)}return a==null||a.subscribe("data",p),()=>{a==null||a.unsubscribe("data",p),a==null||a.destory()}},[a,E,c]);const{getTableProps:V,getTableBodyProps:J,headerGroups:j,rows:O,prepareRow:de,setFilter:Y}=Q.exports.useTable({columns:I,data:A,autoResetSortBy:!1,autoResetFilters:!1,initialState:{sortBy:[{id:y.Time,desc:!1}]}},Q.exports.useResizeColumns,Q.exports.useBlockLayout,Q.exports.useFilters,Q.exports.useSortBy),q=d.exports.useMemo(()=>j[0],[j]),W=d.exports.useCallback(function(p){switch(p.column.id){case y.Speed:return Jt(p.value[0],p.value[1]);case y.Upload:case y.Download:return M(p.value);case y.Time:return Pe(new Date(p.value),n);default:return p.value}},[n]),[pe,ne]=d.exports.useState("");function se(p){ne(p),Y==null||Y(y.SourceIP,p||void 0)}const[B,x]=ue({visible:!1,selectedID:"",connection:{}});function oe(p){x({visible:!0,selectedID:p})}function ae(){x(p=>{p.connection.completed=!0}),o.closeConnection(B.selectedID)}const K=dt(B.connection);return d.exports.useEffect(()=>{var C;const p=(C=A.find(v=>v.id===B.selectedID))==null?void 0:C.original;p?x(v=>{v.connection=b({},p),B.selectedID===K.current.id&&(v.connection.completed=K.current.completed)}):Object.keys(K.current).length!==0&&!K.current.completed&&x(v=>{v.connection.completed=!0})},[A,B.selectedID,K,x]),t.createElement("div",{className:"page"},t.createElement(z,{title:s("title")},t.createElement("span",{className:"connections-filter flex-1 cursor-default"},`(${s("total.text")}: ${s("total.upload")} ${M(l.uploadTotal)} ${s("total.download")} ${M(l.downloadTotal)})`),t.createElement(Xe,{className:"connections-filter",checked:w,onChange:F},s("keepClosed")),t.createElement(R,{className:"connections-filter dangerous",onClick:f,type:"close-all",size:20})),L.length>1&&t.createElement(zt,{devices:L,selected:pe,onChange:se}),t.createElement(U,{ref:r,className:"connections-card relative"},t.createElement("div",D(b({},V()),{className:"flex flex-col w-full flex-1 overflow-auto",style:{flexBasis:0},ref:k}),t.createElement("div",D(b({},q.getHeaderGroupProps()),{className:"connections-header"}),q.headers.map((p,C)=>{const v=p,Z=v.id;return t.createElement("div",D(b({},v.getHeaderProps()),{className:g("connections-th",{resizing:v.isResizing,fixed:P>0&&v.id===y.Host}),key:Z}),t.createElement("div",b({},v.getSortByToggleProps()),p.render("Header"),v.isSorted?v.isSortedDesc?" \u2193":" \u2191":null),C!==q.headers.length-1&&t.createElement("div",D(b({},v.getResizerProps()),{className:"connections-resizer"})))})),t.createElement("div",D(b({},J()),{className:"flex-1"}),O.map(p=>(de(p),t.createElement("div",D(b({},p.getRowProps()),{className:"connections-item cursor-default select-none",key:p.original.id,onClick:()=>oe(p.original.id)}),p.cells.map(C=>{const v=g("connections-block",{"text-center":Vt.has(C.column.id),completed:p.original.completed},{fixed:P>0&&C.column.id===y.Host});return t.createElement("div",D(b({},C.getCellProps()),{className:v,key:C.column.id}),W(C))}))))))),t.createElement(Je,{title:s("closeAll.title"),show:u,onClose:i,onOk:m},s("closeAll.content")),t.createElement(Wt,{containerRef:r,visible:B.visible,width:450},t.createElement("div",{className:"flex justify-between items-center h-8"},t.createElement("span",{className:"pl-3 font-bold"},s("info.title")),t.createElement(R,{type:"close",size:16,className:"cursor-pointer",onClick:()=>x("visible",!1)})),t.createElement(jt,{className:"px-5 mt-3",connection:B.connection}),t.createElement("div",{className:"flex justify-end mt-3 pr-3"},t.createElement(be,{type:"danger",disiabled:B.connection.completed,onClick:()=>ae()},s("info.closeConnection")))))}function Yt(){const{translation:e}=S(),{t:n}=e("Settings"),{hostname:s,port:a,secret:o}=ee(),[r,l]=T(we),[c,u]=ue({hostname:"",port:"",secret:""});d.exports.useEffect(()=>{u({hostname:s,port:a,secret:o})},[s,a,o,u]);const f=Ee(Me);function i(){const{hostname:m,port:h,secret:E}=c;f([{hostname:m,port:h,secret:E}])}return t.createElement(Je,{show:!r,title:n("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>l(!0),onOk:i},t.createElement("div",{className:"flex items-center"},t.createElement("div",{className:"md:my-3 w-14 my-1 font-bold"},n("externalControllerSetting.secret")),t.createElement(ie,{className:"md:my-3 w-14 my-1 flex-1",align:"left",inside:!0,value:c.secret,onChange:m=>u("secret",m),onEnter:i})))}function qt(){var u,f;const e=d.exports.useRef(null),n=d.exports.useRef([]),[s,a]=d.exports.useState([]),{translation:o}=S(),{t:r}=o("Logs"),l=Ve(),c=d.exports.useRef((f=(u=e.current)==null?void 0:u.scrollHeight)!=null?f:0);return d.exports.useLayoutEffect(()=>{var m;const i=e.current;i!=null&&c.current===i.scrollTop+i.clientHeight&&(i.scrollTop=i.scrollHeight-i.clientHeight),c.current=(m=i==null?void 0:i.scrollHeight)!=null?m:0}),d.exports.useEffect(()=>{function i(m){n.current=n.current.slice().concat(m.map(h=>D(b({},h),{time:new Date}))),a(n.current)}return l!=null&&(l.subscribe("data",i),n.current=l.buffer(),a(n.current)),()=>l==null?void 0:l.unsubscribe("data",i)},[l]),t.createElement("div",{className:"page"},t.createElement(z,{title:r("title")}),t.createElement(U,{className:"flex flex-col flex-1 mt-2.5 md:mt-4"},t.createElement("ul",{className:"logs-panel",ref:e},s.map((i,m)=>t.createElement("li",{className:"leading-5 inline-block",key:m},t.createElement("span",{className:"mr-4 text-gray-400 text-opacity-90"},xe(i.time).format("YYYY-MM-DD HH:mm:ss")),t.createElement("span",null,"[",i.type,"] ",i.payload))))))}var te;(function(e){e.SPEED_NOTIFY="speed-notify"})(te||(te={}));class Kt{constructor(){this.EE=new $e}notifySpeedTest(){this.EE.emit(te.SPEED_NOTIFY)}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}}var ke=new Kt;const qe={"#909399":0,"#00c520":260,"#ff9a28":600,"#ff3e5e":1/0};function Ke(e){const{config:n,className:s}=e,{set:a}=ce(),o=$(),r=d.exports.useCallback(async m=>{var E;if(X())return(E=await(N==null?void 0:N.getProxyDelay(m)))!=null?E:0;const{data:{delay:h}}=await o.getProxyDelay(m);return h},[o]),l=d.exports.useCallback(async function(){const m=await re.fromPromise(r(n.name),E=>E),h=m.isErr()?0:m.value;a(E=>{const w=E.proxies.find(F=>F.name===n.name);w!=null&&w.history.push({time:Date.now().toString(),delay:h})})},[n.name,r,a]),c=d.exports.useMemo(()=>{var m;return((m=n.history)==null?void 0:m.length)?n.history.slice(-1)[0].delay:0},[n]);d.exports.useLayoutEffect(()=>{const m=()=>{l()};return ke.subscribe(te.SPEED_NOTIFY,m),()=>ke.unsubscribe(te.SPEED_NOTIFY,m)},[l]);const u=d.exports.useMemo(()=>c===0,[c]),f=d.exports.useMemo(()=>Object.keys(qe).find(m=>c<=qe[m]),[c]),i=u?void 0:f;return t.createElement("div",{className:g("proxy-item",{"proxy-error":u},s)},t.createElement("span",{className:"proxy-type",style:{backgroundColor:i}},n.type),t.createElement("p",{className:"proxy-name"},n.name),t.createElement("p",{className:"proxy-delay"},c===0?"-":`${c}ms`))}function Zt(e){const{markProxySelected:n}=ce(),[s]=T(It),{data:a}=We(),o=$(),{config:r}=e;async function l(f){if(await o.changeProxySelected(e.config.name,f),n(e.config.name,f),a.breakConnections){const i=[],m=await o.getConnections();for(const h of m.data.connections)h.chains.includes(e.config.name)&&i.push(h.id);await Promise.all(i.map(h=>o.closeConnection(h)))}}const c=d.exports.useMemo(()=>{var i;const f=new Set;for(const m of r.all){const h=(i=s.get(m))==null?void 0:i.history;(h==null?void 0:h.length)&&h.slice(-1)[0].delay===0&&f.add(m)}return f},[r.all,s]),u=r.type==="Selector";return t.createElement("div",{className:"proxy-group"},t.createElement("div",{className:"w-full h-10 mt-4 flex items-center justify-between md:h-15 md:mt-0 md:w-auto"},t.createElement("span",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap px-5 h-6 w-35 md:w-30"},r.name),t.createElement(me,{className:"mr-5 md:mr-0"},r.type)),t.createElement("div",{className:"py-2 md:py-4 flex-1"},t.createElement(Mt,{className:"ml-5 md:ml-8",data:r.all,onClick:l,errSet:c,select:r.now,canClick:u,rowHeight:30})))}function Qt(e){const{update:n}=je(),{translation:s,lang:a}=S(),o=$(),{provider:r}=e,{t:l}=s("Proxies"),{visible:c,hide:u,show:f}=Ne();function i(){f(),o.healthCheckProvider(r.name).then(async()=>await n()).finally(()=>u())}function m(){f(),o.updateProvider(r.name).then(async()=>await n()).finally(()=>u())}const h=d.exports.useMemo(()=>r.proxies.slice().sort((E,w)=>-1*De(E,w)),[r.proxies]);return t.createElement(U,{className:"proxy-provider"},t.createElement(Ye,{visible:c}),t.createElement("div",{className:"flex justify-between flex-col md:flex-row md:items-center"},t.createElement("div",{className:"flex items-center"},t.createElement("span",{className:"mr-6"},r.name),t.createElement(me,null,r.vehicleType)),t.createElement("div",{className:"flex items-center pt-3 md:pt-0"},r.updatedAt&&t.createElement("span",{className:"text-sm"},`${l("providerUpdateTime")}: ${Pe(new Date(r.updatedAt),a)}`),t.createElement(R,{className:"pl-5 cursor-pointer text-red",type:"healthcheck",size:18,onClick:i}),t.createElement(R,{className:"pl-5 cursor-pointer",type:"update",size:18,onClick:m}))),t.createElement("ul",{className:"proxies-list"},h.map(E=>t.createElement("li",{key:E.name},t.createElement(Ke,{className:"proxy-provider-item",config:E})))))}var Ze;(function(e){e[e.None=0]="None",e[e.Asc=1]="Asc",e[e.Desc=2]="Desc"})(Ze||(Ze={}));const en={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function De(e,n){const s=e.history.length>0?e.history.slice(-1)[0].delay:0;return((n.history.length>0?n.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(s||Number.MAX_SAFE_INTEGER)}function tn(){const{groups:e,global:n}=ce(),{data:s,set:a}=We(),{general:o}=Ce(),{translation:r}=S(),{t:l}=r("Proxies"),c=d.exports.useMemo(()=>o.mode==="global"?[n]:e,[o,e,n]);return t.createElement(t.Fragment,null,c.length!==0&&t.createElement("div",{className:"flex flex-col"},t.createElement(z,{title:l("groupTitle")},t.createElement(Xe,{className:"text-primary-600 text-sm text-shadow-primary cursor-pointer",checked:s.breakConnections,onChange:u=>a("breakConnections",u)},l("breakConnectionsText"))),t.createElement(U,{className:"my-2.5 md:my-4 p-0"},t.createElement("ul",{className:"list-none"},c.map(u=>t.createElement("li",{className:"proxies-group-item",key:u.name},t.createElement(Zt,{config:u})))))))}function nn(){const{providers:e}=je(),{translation:n}=S(),{t:s}=n("Proxies");return t.createElement(t.Fragment,null,e.length!==0&&t.createElement("div",{className:"flex flex-col"},t.createElement(z,{title:s("providerTitle")}),t.createElement("ul",{className:"list-none"},e.map(a=>t.createElement("li",{className:"my-2.5 md:my-4",key:a.name},t.createElement(Qt,{provider:a}))))))}function sn(){const{proxies:e}=ce(),{translation:n}=S(),{t:s}=n("Proxies");function a(){ke.notifySpeedTest()}const{current:o,next:r}=Ut([1,2,0]),l=d.exports.useMemo(()=>{switch(o){case 2:return e.slice().sort((u,f)=>De(u,f));case 1:return e.slice().sort((u,f)=>-1*De(u,f));default:return e.slice()}},[o,e]),c=r;return t.createElement(t.Fragment,null,l.length!==0&&t.createElement("div",{className:"flex flex-col"},t.createElement(z,{title:s("title")},t.createElement(R,{className:"ml-3",type:en[o],onClick:c,size:20}),t.createElement(R,{className:"ml-3",type:"speed",size:20}),t.createElement("span",{className:"proxies-speed-test",onClick:a},s("speedTestText"))),t.createElement("ul",{className:"proxies-list"},l.map(u=>t.createElement("li",{key:u.name},t.createElement(Ke,{config:u}))))))}function on(){return t.createElement("div",{className:"page"},t.createElement(tn,null),t.createElement(nn,null),t.createElement(sn,null))}function an(e){const{update:n}=Oe(),{translation:s,lang:a}=S(),o=$(),{provider:r}=e,{t:l}=s("Rules"),{visible:c,hide:u,show:f}=Ne();function i(){f(),o.updateRuleProvider(r.name).then(async()=>await n()).finally(()=>u())}const m=g("rule-provider-icon",{"rule-provider-loading":c});return t.createElement("div",{className:"rule-provider"},t.createElement("div",{className:"rule-provider-header"},t.createElement("div",{className:"rule-provider-header-part"},t.createElement("span",{className:"rule-provider-name"},r.name),t.createElement(me,null,r.vehicleType),t.createElement(me,{className:"rule-provider-behavior"},r.behavior),t.createElement("span",{className:"rule-provider-update"},`${l("ruleCount")}: ${r.ruleCount}`)),t.createElement("div",{className:"rule-provider-header-part"},r.updatedAt&&t.createElement("span",{className:"rule-provider-update"},`${l("providerUpdateTime")}: ${Pe(new Date(r.updatedAt),a)}`),t.createElement(R,{className:m,type:"update",size:18,onClick:i}))))}function rn(){const{providers:e}=Oe(),{translation:n}=S(),{t:s}=n("Rules");return t.createElement(t.Fragment,null,e.length!==0&&t.createElement("div",{className:"flex flex-col"},t.createElement(z,{title:s("providerTitle")}),t.createElement(U,{className:"rounded shadow-primary p-0 divide-y mt-4"},e.map(a=>t.createElement(an,{key:a.name,provider:a})))))}function ln(){const{rules:e,update:n}=Tt(),{translation:s}=S(),{t:a}=s("Rules");G("rules",n);function o({index:r,style:l}){const c=e[r];return t.createElement("li",{className:"rule-item",style:l},t.createElement("div",{className:"py-1 flex"},t.createElement("div",{className:"rule-type w-40 text-center"},c.type),t.createElement("div",{className:"payload flex-1 text-center"},c.payload),t.createElement("div",{className:"rule-proxy w-40 text-center"},c.proxy)))}return t.createElement("div",{className:"page"},t.createElement(rn,null),t.createElement(z,{className:"not-first:mt-7.5",title:a("title")}),t.createElement(U,{className:"flex flex-col flex-1 mt-2.5 md:mt-4 p-0 focus:outline-none"},t.createElement(pt,{className:"min-h-120"},({height:r,width:l})=>t.createElement(ft,{height:r,width:l,itemCount:e.length,itemSize:50},o))))}const cn=[{label:"\u4E2D\u6587",value:"zh_CN"},{label:"English",value:"en_US"}];function un(){var ne,se,B;const{premium:e}=le(),{data:n,update:s}=Ge(),{general:a,update:o}=Ce(),r=Ee(we),l=ee(),{translation:c,setLang:u,lang:f}=S(),{t:i}=c("Settings"),m=$(),[h,E]=ue({socks5ProxyPort:7891,httpProxyPort:7890,mixedProxyPort:0});d.exports.useEffect(()=>{var x,oe,ae;E("socks5ProxyPort",(x=a==null?void 0:a.socksPort)!=null?x:0),E("httpProxyPort",(oe=a==null?void 0:a.port)!=null?oe:0),E("mixedProxyPort",(ae=a==null?void 0:a.mixedPort)!=null?ae:0)},[a,E]);async function w(x){await m.updateConfig({mode:x}),await o()}async function F(x){await(N==null?void 0:N.setStartAtLogin(x)),await s()}async function A(x){await(N==null?void 0:N.setSystemProxy(x)),await s()}function L(x){u(x)}async function k(){await m.updateConfig({port:h.httpProxyPort}),await o()}async function P(){await m.updateConfig({"socks-port":h.socks5ProxyPort}),await o()}async function I(){await m.updateConfig({"mixed-port":h.mixedProxyPort}),await o()}async function V(x){await m.updateConfig({"allow-lan":x}),await o()}const{hostname:J,port:j}=l,{allowLan:O,mode:de}=a,Y=(ne=n==null?void 0:n.startAtLogin)!=null?ne:!1,q=(se=n==null?void 0:n.systemProxy)!=null?se:!1,W=(B=n==null?void 0:n.isClashX)!=null?B:!1,pe=d.exports.useMemo(()=>{const x=[{label:i("values.global"),value:"Global"},{label:i("values.rules"),value:"Rule"},{label:i("values.direct"),value:"Direct"}];return e&&x.push({label:i("values.script"),value:"Script"}),x},[i,e]);return t.createElement("div",{className:"page"},t.createElement(z,{title:i("title")}),t.createElement(U,{className:"settings-card"},t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.startAtLogin")),t.createElement(ge,{disabled:!(n==null?void 0:n.isClashX),checked:Y,onChange:F})),t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.language")),t.createElement(Te,{options:cn,value:f,onSelect:x=>L(x)}))),t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.setAsSystemProxy")),t.createElement(ge,{disabled:!W,checked:q,onChange:A})),t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.allowConnectFromLan")),t.createElement(ge,{checked:O,onChange:V})))),t.createElement(U,{className:"settings-card"},t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.proxyMode")),t.createElement(Te,{options:pe,value:ht(de),onSelect:w})),t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.socks5ProxyPort")),t.createElement(ie,{className:"w-28",disabled:W,value:h.socks5ProxyPort,onChange:x=>E("socks5ProxyPort",+x),onBlur:P}))),t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.httpProxyPort")),t.createElement(ie,{className:"w-28",disabled:W,value:h.httpProxyPort,onChange:x=>E("httpProxyPort",+x),onBlur:k})),t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.mixedProxyPort")),t.createElement(ie,{className:"w-28",disabled:W,value:h.mixedProxyPort,onChange:x=>E("mixedProxyPort",+x),onBlur:I}))),t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-full flex md:w-1/2 items-center justify-between px-8 py-3"},t.createElement("span",{className:"label font-bold"},i("labels.externalController")),t.createElement("span",{className:g({"modify-btn":!W},"external-controller"),onClick:()=>!W&&r(!1)},`${J}:${j}`)),t.createElement("div",{className:"w-1/2 px-8"}))))}var mn="./assets/logo.b453e72f.png";function dn(e){const{routes:n}=e,{translation:s}=S(),{version:a,premium:o}=le(),{data:r}=Ge(),{t:l}=s("SideBar"),c=n.map(({path:u,name:f,exact:i,noMobile:m})=>t.createElement("li",{className:g("item",{"no-mobile":m}),key:f},t.createElement(Et,{to:u,activeClassName:"active",exact:!!i},l(f))));return t.createElement("div",{className:"sidebar"},t.createElement("img",{src:mn,alt:"logo",className:"sidebar-logo"}),t.createElement("ul",{className:"sidebar-menu"},c),t.createElement("div",{className:"sidebar-version"},t.createElement("span",{className:"sidebar-version-label"},"Clash",(r==null?void 0:r.isClashX)&&"X"," ",l("Version")),t.createElement("span",{className:"sidebar-version-text"},a),o&&t.createElement("span",{className:"sidebar-version-label"},"Premium")))}function pn(){Ve();const e=[{path:"/proxies",name:"Proxies",component:on},{path:"/logs",name:"Logs",component:qt},{path:"/rules",name:"Rules",component:ln,noMobile:!0},{path:"/connections",name:"Connections",component:Xt,noMobile:!0},{path:"/settings",name:"Settings",component:un}];return t.createElement("div",{className:g("app",{"not-clashx":!X()})},t.createElement(dn,{routes:e}),t.createElement("div",{className:"page-container"},t.createElement(yt,null,t.createElement(Be,{exact:!0,path:"/",component:()=>t.createElement(xt,{to:"/proxies"})}),e.map(n=>t.createElement(Be,{exact:!1,path:n.path,key:n.path,component:n.component})))),t.createElement(Yt,null))}function Qe(){const e=document.getElementById("root"),n=t.createElement(gt,null,t.createElement(d.exports.Suspense,{fallback:t.createElement(Ye,{visible:!0})},t.createElement(pn,null)));ye.exports.render(n,e)}X()?Ct(()=>Qe()):Qe();
